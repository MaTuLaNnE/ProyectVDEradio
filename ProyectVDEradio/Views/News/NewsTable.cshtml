@{
    ViewBag.Title = "NewsTable";
}

@model List<ProyectVDEradio.Models.News>

<div class="container">
    <div class="section">
        <h2>Gestión de Noticias</h2>
        <div class="subtitle">Administra todos los usuarios del sistema </div>
        <div class="form-divider"></div>

        <div class="table-header">
            <div class="table-title">
                <span class="user-count">Total: @(Model?.Count() ?? 0) usuarios</span>
            </div>
            <div class="table-actions">
                @Html.ActionLink("Crear Nueva Noticia", "Create", null, new { @class = "btn btn-primary" })
            </div>
        </div>
        <div class="table-container">
            <table class=modern-table>
                <thead>
                    <tr>
                        <th>Título</th>
                        <th>Categoría</th>
                        <th>Autor</th>
                        <th>Fecha</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var noticia in Model)
                    {
                        <tr>
                            <td>
                                <div class="user-info">
                                    <div class="user-details">
                                        <h4>@noticia.ArticleTitle</h4>
                                        <span>ID: @noticia.ArticleID</span>
                                    </div>
                                </div>
                            </td>
                            <td>@noticia.Categories.CategoryName</td>
                            <td>@noticia.Users.UserName</td>
                            <td>@noticia.ArticleDate.ToShortDateString()</td>
                            <td>
                                @Html.ActionLink("Editar", "Edit", new { id = noticia.ArticleID }, new { @class = "btn btn-warning" })
                                @Html.Raw($"<a href='#' class='action-btn btn-danger' onclick=\"showDeleteModal('{noticia.ArticleTitle}', '{noticia.ArticleID}')\">Eliminar</a>")
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- MODAL ELIMINAR NOTICIA -->
        <div id="deleteModal" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <button class="modal-close" onclick="closeDeleteModal()">×</button>
                    <span class="modal-icon"></span>
                    <h2 class="modal-title">Eliminar Noticia</h2>
                    <p class="modal-subtitle">Esta acción no se puede deshacer</p>
                </div>

                <div class="modal-body">
                    <div class="user-info-card">
                        <div class="user-avatar-large" id="modalNewsAvatar">N</div>
                        <div class="user-details-card">
                            <h4 id="modalNewsTitle"></h4>
                            <div class="user-detail-item">
                                <span class="user-detail-label">ID:</span>
                                <span class="user-detail-value" id="modalNewsId"></span>
                            </div>
                        </div>
                    </div>

                    <div class="warning-message">
                        <strong>¡Atención!</strong> Esta acción eliminará permanentemente la noticia y toda su información asociada.
                    </div>

                    <div class="consequences-list">
                        <li>Se eliminará el contenido de la noticia</li>
                        <li>No se podrá recuperar posteriormente</li>
                        <li>La noticia desaparecerá de la web</li>
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="modal-btn btn-cancel" onclick="closeDeleteModal()">
                        Cancelar
                    </button>
                    @using (Html.BeginForm("DeleteConfirmed", "News", FormMethod.Post))
                    {
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" id="hiddenNewsIdToDelete" />
                        <button type="submit" class="modal-btn btn-delete">
                            Eliminar Noticias
                        </button>
                    }
                </div>
            </div>
        </div>

        <div class="back-link">
            <a href="@Url.Action("Index", "Management")" class="crud-btn btn-listar">
                ← Volver al Panel de Gestión
            </a>
        </div>
    </div>
</div>

<script>
    function showDeleteModal(title, id) {
        document.getElementById('modalNewsTitle').textContent = title;
        document.getElementById('modalNewsId').textContent = id;
        document.getElementById('modalNewsAvatar').textContent = title.charAt(0).toUpperCase();
        document.getElementById('hiddenNewsIdToDelete').value = id;

        const modal = document.getElementById('deleteModal');
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeDeleteModal() {
        const modal = document.getElementById('deleteModal');
        modal.classList.remove('active');
        document.body.style.overflow = 'auto';
    }

    // Cerrar modal al hacer clic en el overlay
    document.getElementById('deleteModal').addEventListener('click', function (e) {
        if (e.target === this) {
            closeDeleteModal();
        }
    });

    // Cerrar modal con la tecla Escape
    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
            closeDeleteModal();
        }
    });
</script>